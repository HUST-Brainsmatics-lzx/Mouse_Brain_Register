function slice_result_preview
allinfo=get(gcf,'UserData');
slice_rh=allinfo.slice_rh;
atlas_lh=allinfo.atlas_lh;
slice_lh=allinfo.slice_lh;
atlas_ih=allinfo.atlas_ih;
slice_ih=allinfo.slice_ih;
if length(atlas_lh.XData)~=length(slice_lh.XData)
    warndlg('Unpaired Feature Points!','Warning');
    return
elseif isempty(atlas_lh.XData)
    warndlg('No Feature Point Detected!','Warning');
    return
end
if ~isempty(slice_rh.XData)
    id=inpolygon(slice_lh.XData,slice_lh.YData,slice_rh.XData,slice_rh.YData);
    set(atlas_lh,'XData',atlas_lh.XData(id),'YData',atlas_lh.YData(id))
    set(slice_lh,'XData',slice_lh.XData(id),'YData',slice_lh.YData(id))
end
Xa=atlas_lh.XData;
Ya=atlas_lh.YData;
Xs=slice_lh.XData;
Ys=slice_lh.YData;
[Yw,Xw]=find(atlas_ih.CData==2^16-1);
half_id=sum(Xw<=570);
[Xw,Yw]= tpswarp_rewrite([Xw,Yw],[Xa;Ya]',[Xs;Ys]');
register_info.Xa=Xa;
register_info.Ya=Ya;
register_info.Xs=Xs;
register_info.Ys=Ys;
register_info.slicename=[allinfo.slice_filepath,allinfo.slice_filename(get(allinfo.slice_page_eh,'UserData')).name];
register_info.atlas=atlas_ih.CData;
%Xw=min(max(Xw,0),size(slice_ih.CData,2));
%Yw=min(max(Yw,0),size(slice_ih.CData,1));
%预览图操作界面
figure('Name','Registration Preview','NumberTitle','off','Resize','off',...
        'MenuBar','figure','Units','Normalized','Position',[0.05,0.05,0.9,0.85],...
        'UserData',register_info)
delete(allchild(gcf))
screensize=get(0,'ScreenSize');
w=round(screensize(3)*0.9*0.89);
h=round(screensize(4)*0.85*0.99);
axes('Units','Normalized','Position',[0.005,0.005,0.89,0.99],'Tag','background','XLim',[0.5,w+0.5],'YLim',[0.5,h+0.5])
imshow(zeros(h,w))
axes('Units','Normalized','Position',[0.005,0.005,0.89,0.99],'XLim',[0.5,size(slice_ih.CData,2)+0.5],'YLim',[0.5,size(slice_ih.CData,1)+0.5])
%保存按钮;
uicontrol('Style','PushButton','String','Export Image',...
    'Callback','slice_image_export',...
    'Fontunits','Normalized','Fontsize',0.6,...
    'Units','Normalized','Position',[0.9 0.055 0.095 0.04]);
uicontrol('Style','PushButton','String','Save & Close',...
    'Callback','close;slice_result_save',...
    'Fontunits','Normalized','Fontsize',0.5,'FontWeight','Bold',...
    'Units','Normalized','Position',[0.9 0.005 0.095 0.04]);
%左右轮廓按钮
uicontrol('Style','CheckBox','Tag','Left','Value',1,...
    'Callback','slice_result_preview_button',...
    'String','Show Left Atlas','Fontunits','Normalized','Fontsize',0.7,...
    'Units','Normalized','Position',[0.9 0.145 0.095 0.03]);
uicontrol('Style','CheckBox','Tag','Right','Value',1,...
    'Callback','slice_result_preview_button',...
    'String','Show Right Atlas','Fontunits','Normalized','Fontsize',0.7,...
    'Units','Normalized','Position',[0.9 0.105 0.095 0.03])
%线宽
bgh=uibuttongroup('Title','Line Width','FontSize',14,'Units','Normalized','Position',[0.9 0.295 0.095 0.10]);
uicontrol('Parent',bgh,'Style','RadioButton','String','+0',...
    'Fontunits','Normalized','Fontsize',0.8,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.07 0.55 0.25 0.3]);
uicontrol('Parent',bgh,'Style','RadioButton','String','+1',...
    'Fontunits','Normalized','Fontsize',0.8,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.40 0.55 0.25 0.3]);
uicontrol('Parent',bgh,'Style','RadioButton','String','+2',...
    'Fontunits','Normalized','Fontsize',0.8,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.73 0.55 0.25 0.3]);
uicontrol('Parent',bgh,'Style','RadioButton','String','+3',...
    'Fontunits','Normalized','Fontsize',0.8,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.07 0.15 0.25 0.3]);
uicontrol('Parent',bgh,'Style','RadioButton','String','+4',...
    'Fontunits','Normalized','Fontsize',0.8,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.40 0.15 0.25 0.3]);
uicontrol('Parent',bgh,'Style','RadioButton','String','...',...
    'Callback','slice_result_preview_button','Tag','Custom_Line_Width',...
    'Fontunits','Normalized','Fontsize',0.8,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.73 0.15 0.25 0.3]);
%颜色按钮
bgh=uibuttongroup('Title','Line Color','FontSize',14,'Units','Normalized','Position',[0.9 0.185 0.095 0.10]);
uicontrol('Parent',bgh,'Style','RadioButton','String','R','ForegroundColor',[1,0,0],...
    'Callback','slice_result_preview_button','Tag','Line_Color',...
    'Fontunits','Normalized','Fontsize',0.7,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.07 0.65 0.2 0.3]);
uicontrol('Parent',bgh,'Style','RadioButton','String','G','ForegroundColor',[0,1,0],...
    'Callback','slice_result_preview_button','Tag','Line_Color',...
    'Fontunits','Normalized','Fontsize',0.7,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.40 0.65 0.2 0.3]);
uicontrol('Parent',bgh,'Style','RadioButton','String','B','ForegroundColor',[0,0,1],...
    'Callback','slice_result_preview_button','Tag','Line_Color',...
    'Fontunits','Normalized','Fontsize',0.7,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.73 0.65 0.2 0.3]);
uicontrol('Parent',bgh,'Style','RadioButton','String','Y','ForegroundColor',[1,1,0],...
    'Callback','slice_result_preview_button','Tag','Line_Color',...
    'Fontunits','Normalized','Fontsize',0.7,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.07 0.35 0.2 0.3]);
uicontrol('Parent',bgh,'Style','RadioButton','String','M','ForegroundColor',[1,0,1],...
    'Callback','slice_result_preview_button','Tag','Line_Color',...
    'Fontunits','Normalized','Fontsize',0.7,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.40 0.35 0.2 0.3]);
uicontrol('Parent',bgh,'Style','RadioButton','String','C','ForegroundColor',[0,1,1],...
    'Callback','slice_result_preview_button','Tag','Line_Color',...
    'Fontunits','Normalized','Fontsize',0.7,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.73 0.35 0.2 0.3]);
uicontrol('Parent',bgh,'Style','RadioButton','String','K','ForegroundColor',[0,0,0],...
    'Callback','slice_result_preview_button','Tag','Line_Color',...
    'Fontunits','Normalized','Fontsize',0.7,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.07 0.05 0.2 0.3]);
uicontrol('Parent',bgh,'Style','RadioButton','String','W','ForegroundColor',[1,1,1],'Value',1,...
    'Callback','slice_result_preview_button','Tag','Line_Color',...
    'Fontunits','Normalized','Fontsize',0.7,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.40 0.05 0.2 0.3]);
uicontrol('Parent',bgh,'Style','RadioButton','String','...','ForegroundColor',[0,0,0],...
    'Callback','slice_result_preview_button','Tag','Line_Color',...
    'Fontunits','Normalized','Fontsize',0.7,'Fontweight','Bold',...
    'Units','Normalized','Position',[0.73 0.05 0.2 0.3]);
%显示配准结果
imshow(uint8((double(slice_ih.CData)-30)/225*255));
line('XData',Xw(1:half_id),'YData',Yw(1:half_id),'Tag','Left',...
    'LineStyle','none','Marker','.','MarkerEdgeColor','c','Markersize',0.1)
line('XData',Xw(end:-1:half_id+1),'YData',Yw(end:-1:half_id+1),'Tag','Right',...
    'LineStyle','none','Marker','.','MarkerEdgeColor','c','Markersize',0.1)
clc